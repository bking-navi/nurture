<div class="px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-6">
    <div class="flex items-center justify-between mb-2">
      <h1 class="text-3xl font-bold text-gray-900">Creative Library</h1>
      <%= link_to "+ Upload Creative", new_creative_path(@advertiser.slug), class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-900 hover:bg-gray-800" %>
    </div>
    <p class="text-gray-600">Manage and reuse your postcard designs across campaigns.</p>
  </div>

  <!-- Filters -->
  <div class="bg-white shadow sm:rounded-lg p-4 mb-6">
    <%= form_with url: creatives_path(@advertiser.slug), method: :get, local: true, class: "flex flex-wrap gap-4 items-end" do |f| %>
      <div class="flex-1 min-w-[200px]">
        <%= f.label :search, "Search", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :search, value: params[:search], placeholder: "Search by name or description...", class: "mt-1 block w-full shadow-sm focus:ring-gray-700 focus:border-gray-700 sm:text-sm border-gray-300 rounded-md" %>
      </div>

      <div class="w-48">
        <%= f.label :size, "Postcard Size", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :size, [["6x9", "6x9"]], { include_blank: "All Sizes" }, class: "mt-1 block w-full shadow-sm focus:ring-gray-700 focus:border-gray-700 sm:text-sm border-gray-300 rounded-md bg-gray-100", disabled: true %>
        <p class="mt-1 text-xs text-gray-500">All postcards are 6"x9"</p>
      </div>

      <div class="w-48">
        <%= f.label :sort, "Sort By", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :sort, options_for_select([["Recent", "recent"], ["Popular", "popular"], ["Name", "name"]], params[:sort] || "recent"), {}, class: "mt-1 block w-full shadow-sm focus:ring-gray-700 focus:border-gray-700 sm:text-sm border-gray-300 rounded-md" %>
      </div>

      <div class="flex space-x-2">
        <%= f.submit "Filter", class: "px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-900 hover:bg-gray-800" %>
        <%= link_to "Clear", creatives_path(@advertiser.slug), class: "px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" %>
      </div>
    <% end %>
  </div>

  <!-- Tag Filter (if tag param present) -->
  <% if params[:tag].present? %>
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6 flex items-center justify-between">
      <div class="flex items-center">
        <span class="text-sm text-blue-900">Showing creatives tagged with:</span>
        <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
          <%= params[:tag] %>
        </span>
      </div>
      <%= link_to "Clear filter", creatives_path(@advertiser.slug), class: "text-sm text-blue-700 hover:text-blue-900" %>
    </div>
  <% end %>

  <!-- Stats -->
  <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
    <div class="flex items-center justify-between text-sm text-gray-600">
      <span><%= pluralize(@creatives.count, 'creative') %> in library</span>
    </div>
  </div>

  <% if @creatives.empty? %>
    <!-- Empty State -->
    <div class="text-center py-12 bg-white shadow sm:rounded-lg">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
      </svg>
      <h3 class="mt-2 text-sm font-medium text-gray-900">No creatives found</h3>
      <p class="mt-1 text-sm text-gray-500">
        <% if params[:search].present? || params[:size].present? || params[:tag].present? %>
          Try adjusting your filters or clearing them.
        <% else %>
          Get started by uploading your first creative.
        <% end %>
      </p>
      <div class="mt-6">
        <%= link_to "Upload Creative", new_creative_path(@advertiser.slug), class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-900 hover:bg-gray-800" %>
      </div>
    </div>
  <% else %>
    <!-- Creative Grid -->
    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
      <% @creatives.each do |creative| %>
        <%= link_to creative_path(@advertiser.slug, creative), class: "group" do %>
          <div class="bg-white shadow rounded-lg overflow-hidden hover:shadow-xl transition-shadow duration-200">
            <!-- Thumbnail -->
            <div class="aspect-[2/3] bg-gray-200 flex items-center justify-center relative overflow-hidden">
              <% if creative.thumbnail.attached? %>
                <%= image_tag creative.thumbnail, class: "w-full h-full object-cover" %>
              <% elsif creative.front_pdf.attached? %>
                <!-- Placeholder for PDF (thumbnail will be generated) -->
                <div class="flex flex-col items-center justify-center text-gray-400">
                  <svg class="h-16 w-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                  </svg>
                  <span class="text-sm mt-2">Generating thumbnail...</span>
                </div>
              <% else %>
                <svg class="h-16 w-16 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                </svg>
              <% end %>
              
              <!-- Approval status badge -->
              <% if creative.approved? %>
                <div class="absolute top-2 left-2 bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded flex items-center">
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  Approved
                </div>
              <% elsif creative.pending_approval? %>
                <div class="absolute top-2 left-2 bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-1 rounded">
                  Pending Approval
                </div>
              <% elsif creative.failed_validation? %>
                <div class="absolute top-2 left-2 bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded">
                  Failed
                </div>
              <% elsif creative.approval_status == 'rejected' %>
                <div class="absolute top-2 left-2 bg-orange-100 text-orange-800 text-xs font-medium px-2 py-1 rounded">
                  Rejected
                </div>
              <% end %>
              
              <!-- Usage badge -->
              <% if creative.used? %>
                <div class="absolute top-2 right-2 bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded">
                  Used <%= creative.usage_count %>x
                </div>
              <% end %>
            </div>

            <!-- Info -->
            <div class="p-4">
              <h3 class="text-sm font-medium text-gray-900 truncate group-hover:text-gray-700">
                <%= creative.name %>
              </h3>
              
              <div class="mt-1 flex items-center text-xs text-gray-500">
                <span>6x9</span>
                <% if creative.back_pdf.attached? %>
                  <span class="mx-1">â€¢</span>
                  <span>2-sided</span>
                <% end %>
              </div>

              <!-- Tags -->
              <% if creative.tags.any? %>
                <div class="mt-2 flex flex-wrap gap-1">
                  <% creative.tags.first(3).each do |tag| %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                      <%= tag %>
                    </span>
                  <% end %>
                  <% if creative.tags.count > 3 %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                      +<%= creative.tags.count - 3 %>
                    </span>
                  <% end %>
                </div>
              <% end %>

              <div class="mt-3 text-xs text-gray-500">
                <% if creative.last_used_at %>
                  Last used <%= time_ago_in_words(creative.last_used_at) %> ago
                <% else %>
                  Not yet used
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>
