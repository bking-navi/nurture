<div class="max-w-7xl mx-auto" 
     data-controller="preview-updater"
     data-preview-updater-advertiser-slug-value="<%= advertiser.slug %>"
     data-preview-updater-campaign-id-value="<%= campaign.id %>">
  
  <!-- Template Selection -->
  <%= form_with model: campaign, 
                url: campaign_path(advertiser.slug, campaign), 
                method: :patch, 
                local: false,
                data: { turbo_frame: "design-content", controller: "auto-submit" } do |f| %>
    <%= hidden_field_tag :tab, 'design' %>
    
    <div class="mb-8">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Choose Your Template</h3>
      <p class="text-sm text-gray-600 mb-6">Select a professionally designed postcard template</p>
      
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
        <% @templates.each do |template| %>
          <label class="relative cursor-pointer group">
            <%= f.radio_button :postcard_template_id, 
                  template.id,
                  checked: campaign.postcard_template_id == template.id,
                  class: "peer sr-only",
                  data: { action: "change->auto-submit#submit" } %>
            
            <div class="border-2 rounded-lg overflow-hidden transition-all peer-checked:border-indigo-500 peer-checked:ring-2 peer-checked:ring-indigo-500 hover:border-gray-400">
              <!-- Template preview card -->
              <div class="aspect-[6/9] <%= 
                case template.category
                when 'offer' then 'bg-gradient-to-br from-red-100 to-orange-100'
                when 'product' then 'bg-gradient-to-br from-blue-100 to-cyan-100'
                when 'event' then 'bg-gradient-to-br from-purple-100 to-pink-100'
                when 'welcome' then 'bg-gradient-to-br from-green-100 to-teal-100'
                when 'seasonal' then 'bg-gradient-to-br from-amber-100 to-yellow-100'
                else 'bg-gradient-to-br from-gray-100 to-gray-200'
                end
              %> flex items-center justify-center text-4xl">
                <%= 
                  case template.category
                  when 'offer' then 'ðŸ”¥'
                  when 'product' then 'ðŸ“¦'
                  when 'event' then 'ðŸŽ‰'
                  when 'welcome' then 'ðŸ’Œ'
                  when 'seasonal' then 'ðŸŽ„'
                  else 'ðŸ“®'
                  end
                %>
              </div>
              
              <div class="p-3 bg-white border-t">
                <div class="text-sm font-medium text-gray-900"><%= template.name %></div>
                <div class="text-xs text-gray-500 mt-0.5"><%= template.category_label %></div>
              </div>
              
              <!-- Selected indicator -->
              <div class="hidden peer-checked:flex absolute top-2 right-2 items-center justify-center w-6 h-6 bg-indigo-600 rounded-full">
                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
              </div>
            </div>
          </label>
        <% end %>
      </div>
    </div>
  <% end %>
  
  <!-- Design Content (loads via Turbo Frame) -->
  <%= render "campaigns/tabs/design_content", campaign: campaign, advertiser: advertiser %>
</div>
