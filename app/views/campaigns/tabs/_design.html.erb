<div class="max-w-4xl mx-auto">
  
  <!-- PDF Upload Section -->
  <div class="mb-8">
    <h3 class="text-lg font-medium text-gray-900 mb-2">Upload Your Design</h3>
    <p class="text-sm text-gray-600 mb-6">Upload PDF files for the front and back of your postcard</p>
    
    <%= form_with model: campaign, 
                  url: campaign_path(advertiser.slug, campaign), 
                  method: :patch,
                  local: true,
                  multipart: true,
                  data: { turbo: false } do |f| %>
      <%= hidden_field_tag :tab, 'design' %>
      
      <div class="bg-white rounded-lg border border-gray-200 p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Front PDF Upload -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Front Side (PDF)
              <span class="text-red-600">*</span>
            </label>
            
            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors">
              <div class="space-y-1 text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                  <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <div class="flex text-sm text-gray-600">
                  <label class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500">
                    <span>Upload a file</span>
                    <%= f.file_field :front_pdf, accept: "application/pdf", class: "sr-only", onchange: "showFileName(this, 'front-file-name')" %>
                  </label>
                  <p class="pl-1">or drag and drop</p>
                </div>
                <p class="text-xs text-gray-500">PDF up to 10MB</p>
                <p class="text-xs text-gray-500">6x9 inches recommended</p>
              </div>
            </div>
            
            <div id="front-file-name" class="mt-2 hidden">
              <div class="flex items-center gap-2 text-sm text-blue-600">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span id="front-file-text"></span>
              </div>
            </div>
            
            <% if campaign.front_pdf.attached? %>
              <div class="mt-2 flex items-center gap-2 text-sm text-green-600">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>✓ Previously uploaded: <%= campaign.front_pdf.filename %></span>
              </div>
            <% end %>
          </div>
          
          <!-- Back PDF Upload -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Back Side (PDF)
              <span class="text-red-600">*</span>
            </label>
            
            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors">
              <div class="space-y-1 text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                  <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <div class="flex text-sm text-gray-600">
                  <label class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500">
                    <span>Upload a file</span>
                    <%= f.file_field :back_pdf, accept: "application/pdf", class: "sr-only", onchange: "showFileName(this, 'back-file-name')" %>
                  </label>
                  <p class="pl-1">or drag and drop</p>
                </div>
                <p class="text-xs text-gray-500">PDF up to 10MB</p>
                <p class="text-xs text-gray-500">6x9 inches recommended</p>
              </div>
            </div>
            
            <div id="back-file-name" class="mt-2 hidden">
              <div class="flex items-center gap-2 text-sm text-blue-600">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span id="back-file-text"></span>
              </div>
            </div>
            
            <% if campaign.back_pdf.attached? %>
              <div class="mt-2 flex items-center gap-2 text-sm text-green-600">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>✓ Previously uploaded: <%= campaign.back_pdf.filename %></span>
              </div>
            <% end %>
          </div>
        </div>
        
        <div class="mt-6 flex items-center justify-between pt-4 border-t border-gray-200">
          <div class="text-sm text-gray-500">
            <span class="font-medium">Requirements:</span> PDF format, 6x9 inches, 300 DPI
          </div>
          <%= f.submit "Upload Files", class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700" %>
        </div>
      </div>
    <% end %>
    
    <script>
      function showFileName(input, displayId) {
        const displayDiv = document.getElementById(displayId);
        const textSpan = document.getElementById(displayId.replace('-name', '-text'));
        
        if (input.files && input.files[0]) {
          const fileName = input.files[0].name;
          const fileSize = (input.files[0].size / 1024 / 1024).toFixed(2); // MB
          
          textSpan.textContent = `Selected: ${fileName} (${fileSize} MB)`;
          displayDiv.classList.remove('hidden');
        } else {
          displayDiv.classList.add('hidden');
        }
      }
    </script>
  </div>
  
  <!-- Or Use Template Button -->
  <div class="mb-8 text-center">
    <button type="button" 
            onclick="document.getElementById('template-section').classList.toggle('hidden')"
            class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>
      </svg>
      Or use a custom template
    </button>
  </div>
  
  <!-- Template Selection (Hidden by default) -->
  <div id="template-section" class="hidden">
    <%= form_with model: campaign, 
                  url: campaign_path(advertiser.slug, campaign), 
                  method: :patch, 
                  local: true,
                  data: { controller: "auto-submit" } do |f| %>
      <%= hidden_field_tag :tab, 'design' %>
      
      <div class="mb-8">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Choose a Template</h3>
        <p class="text-sm text-gray-600 mb-6">Select a professionally designed postcard template</p>
        
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          <% @templates.each do |template| %>
            <label class="relative cursor-pointer group">
              <%= f.radio_button :postcard_template_id, 
                    template.id,
                    checked: campaign.postcard_template_id == template.id,
                    class: "peer sr-only",
                    data: { action: "change->auto-submit#submit" } %>
              
              <div class="border-2 rounded-lg overflow-hidden transition-all peer-checked:border-indigo-500 peer-checked:ring-2 peer-checked:ring-indigo-500 hover:border-gray-400">
                <!-- Template preview card -->
                <div class="aspect-[6/9] <%= 
                  case template.category
                  when 'offer' then 'bg-gradient-to-br from-red-100 to-orange-100'
                  when 'product' then 'bg-gradient-to-br from-blue-100 to-cyan-100'
                  when 'event' then 'bg-gradient-to-br from-purple-100 to-pink-100'
                  when 'welcome' then 'bg-gradient-to-br from-green-100 to-teal-100'
                  when 'seasonal' then 'bg-gradient-to-br from-amber-100 to-yellow-100'
                  else 'bg-gradient-to-br from-gray-100 to-gray-200'
                  end
                %> flex items-center justify-center text-4xl">
                  <%= 
                    case template.category
                    when 'offer' then '🔥'
                    when 'product' then '📦'
                    when 'event' then '🎉'
                    when 'welcome' then '💌'
                    when 'seasonal' then '🎄'
                    else '📮'
                    end
                  %>
                </div>
                
                <div class="p-3 bg-white border-t">
                  <div class="text-sm font-medium text-gray-900"><%= template.name %></div>
                  <div class="text-xs text-gray-500 mt-0.5"><%= template.category_label %></div>
                </div>
                
                <!-- Selected indicator -->
                <div class="hidden peer-checked:flex absolute top-2 right-2 items-center justify-center w-6 h-6 bg-indigo-600 rounded-full">
                  <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </div>
            </label>
          <% end %>
        </div>
      </div>
    <% end %>
    
    <!-- Design Content for Templates -->
    <% if campaign.postcard_template.present? %>
      <div data-controller="preview-updater"
           data-preview-updater-advertiser-slug-value="<%= advertiser.slug %>"
           data-preview-updater-campaign-id-value="<%= campaign.id %>">
        <%= form_with model: campaign, 
                      url: campaign_path(advertiser.slug, campaign), 
                      method: :patch,
                      local: true do |f| %>
          <%= hidden_field_tag :tab, 'design' %>
          <%= render "campaigns/tabs/design_form", campaign: campaign, advertiser: advertiser, f: f %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
